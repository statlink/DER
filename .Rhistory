library(prais)
library(praise)
pr_init(branch = "formidable")
library(usethis)
pr_init(branch = "formidable")
pr_push()
paf2 <- function(y, a, ncores = 1) {
y <- y / mean(y)
n <- length(y)
d <- Rfast::vecdist(y)
if ( length(a) == 1 ) {
h <- 4.7 / sqrt(n) * sd(y) * a^0.1  ## bandwidth
fhat <- Rfast::rowmeans( exp( -0.5 * d^2 / h^2 ) ) / sqrt(2 * pi) / h
fhata <- fhat^a
#paf <- sum( fhata * d ) / n^2
paf <- sum( Rfast::eachcol.apply(d, fhata) ) / n^2
alien <- mean(d)
ident <- mean(fhata)
rho <- paf / (alien * ident) - 1
res <- c(paf, alien, ident, 1 + rho)
# reslist <- paf_fun(y, a, h, ncores)
# rho <- reslist$paf / (reslist$alien * reslist$ident) - 1
# res <- c(reslist$paf, reslist$alien, reslist$ident, 1 + rho)
names(res) <- c("paf", "alienation", "identification", "1 + rho")
} else {
com <- 4.7 / sqrt(n) * sd(y)
d2 <-  -0.5 * d^2
alien <- mean(d)
lena <- length(a)
paf <- ident <- numeric(lena)
for ( i in 1:lena ) {
h <- com * a[i]^0.1  ## bandwidth
fhat <- Rfast::rowmeans( exp( d2 / h^2 ) ) / sqrt(2 * pi) / h
fhata <- fhat^a[i]
#paf[i] <- sum( fhata * d ) / n^2
paf[i] <- sum( Rfast::eachcol.apply(d, fhata) ) / n^2
ident[i] <- mean(fhata)
}
rho <- paf / ( alien * ident ) - 1
res <- cbind(paf, alien, ident, 1 + rho)
colnames(res) <- c("paf", "alienation", "identification", "1 + rho")
rownames(res) <- paste( "alpha=", a, sep = "" )
}
res
}
set.seed(42)
y <- rgamma(100, 10, 0.01)
paf(y, 0.25)
paf2(y, 0.25)
DER::paf(y, 0.25)
y <- rgamma(100, 10, 0.01)
paf.boot(y, 0.25)
a=0.25
R = 1000
index <- DER::paf(y, a)
index
DER::paf(y, a)
y
a
paf(y,a)
class(paf(y,a))
class(paf(y,c(a,a*2)))
paf(y,c(a,a*2))
Rfast2::Sample.int
sourceCpp("C:/Users/Administrator/Downloads/paftest.cpp")
Rcpp::sourceCpp("C:/Users/Administrator/Downloads/paftest.cpp")
Rcpp::sourceCpp("C:/Users/Administrator/Downloads/paftest.cpp")
x <- rnorm(1e5)
bench::mark(fast_mean(x), rcpp_mean(x))
x <- rnorm(1e6)
bench::mark(fast_mean(x), rcpp_mean(x))
x <- rnorm(1e4)
bench::mark(fast_mean(x), rcpp_mean(x))
Rcpp::sourceCpp("C:/Users/Administrator/Downloads/paftest.cpp")
bench::mark(fast_sd(x), rcpp_sd(x))
x <- rnorm(1e6)
bench::mark(fast_sd(x), rcpp_sd(x))
